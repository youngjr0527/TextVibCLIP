# TextVibCLIP: Domain-Incremental Continual Learning Methodology (Theory-First)

본 문서는 공저자(특히 Methodology 집필 담당자)를 위한 “이론 중심” 설명서입니다. 구현 세부사항이나 파일 경로를 몰라도, 연구의 문제 정의·핵심 아이디어·학습/평가 절차·데이터 분할 원칙·재현 가능한 설정을 이해하고 정확히 기술할 수 있도록 구성했습니다.

## 1) 문제 정의와 시나리오
- **현실적 과제**: 베어링 진단 모델은 운전 조건(회전 속도, 부하, 베어링 유형 등)이 변하면 분포가 바뀌어 성능이 저하되는 도메인 시프트 문제를 겪습니다.
- **설정**: 본 연구는 “클래스 집합은 고정”이고 “환경(도메인)만 순차적으로 변화”하는 Domain-Incremental Continual Learning을 다룹니다.
  - UOS 시나리오: 회전 속도 600→800→1000→1200→1400→1600 RPM, 7-클래스(H, B, IR, OR, L, U, M)
  - CWRU 시나리오: 부하 0→1→2→3 HP, 4-클래스(H, B, IR, OR)

## 2) 핵심 아이디어: 텍스트-진동 정렬과 비대칭 적응
- **멀티모달 대조학습(Contrastive)**: 진동 신호와 베어링 상태를 기술하는 텍스트를 같은 임베딩 공간으로 정렬하여, 의미(텍스트)를 기준으로 신호 표현을 학습합니다.
- **의미론적 앵커**: 텍스트는 “결함의 의미”를 담고 있어 도메인이 바뀌어도 불변합니다. 반면 진동은 환경에 민감하게 변합니다.
- **비대칭 적응 전략**: 첫 도메인에서는 텍스트·진동을 함께 정렬해 공통 공간을 형성하고, 이후 도메인에서는 텍스트를 거의 고정한 채 진동 인코더만 적극 적응시켜 빠른 전이와 망각 최소화를 동시에 달성합니다.

## 3) 모델 개요(개념적)
- 두 인코더(텍스트·진동)가 각각 입력을 임베딩으로 변환하고, 얕은 투영(Projection)을 통해 동일 차원의 공통 공간으로 맵핑됩니다.
- **대조 손실(Triplet/Ranking)**: 같은 클래스(예: “inner race fault”)의 텍스트-진동 임베딩은 가깝게, 다른 클래스는 떨어지도록 학습합니다(여유 마진 m=0.3 사용).
- **보조 분류(선택적)**: 학습 안정화를 위해 임베딩 위에 얕은 분류 헤드를 두어 교차엔트로피를 함께 최소화합니다(초기 단계 가중치 작게, 적응 단계에서 다소 크게 설정).

## 4) 학습 절차
### 4.1 초기 정렬(First Domain)
- 목적: 텍스트-진동 임베딩 공간을 신뢰성 있게 “맞춰놓는” 단계입니다.
- 방법: 첫 도메인 데이터만 사용하여 대조 손실(+보조 분류)로 공동 학습합니다. 텍스트 측은 소량의 적응(예: LoRA)만 허용해 의미를 보존하면서 도메인-불변 앵커 역할을 준비합니다.

### 4.2 연속 적응(Remaining Domains)
- 목적: 새 환경에 빠르게 적응하면서 이전 환경 성능을 유지합니다.
- 방법: 이후 도메인에서는 텍스트 측은 고정(또는 최소 적응)하고, 진동 인코더와 투영을 중심으로 적응합니다. 이때 작은 **리플레이 버퍼**를 사용해 과거 도메인에서 대표 샘플을 소량 섞어 학습하여 망각을 완화합니다.

### 4.3 리플레이 버퍼 설계
- 구성: 도메인별로 일정 수의 대표 샘플(임베딩과 메타정보)을 저장합니다(예: UOS 500개, CWRU 50개 수준).
- 선택: 기본은 무작위 선택이며, 다양성(K-means) 또는 클래스 균등과 같은 전략으로 대체 가능합니다.
- 사용: 적응 단계에서 미니배치 일부를 과거 도메인 샘플로 채워 현재 도메인 샘플과 혼합하여 학습합니다(예: 배치 절반 빈도).

## 5) 데이터 준비와 분할 원칙(누수 방지)
- **UOS**: 각 도메인에서 하나의 긴 원시 신호를 짧은 윈도우로 분할합니다. 윈도우들을 무작위 인덱스로 분할하여 train/val/test(60/20/20)를 구성해 시간적 인접성으로 인한 누수를 방지합니다.
- **CWRU**: 파일 단위가 적으므로 파일 수준에서 train/val/test를 분리하는 것을 우선하며, 필요 시 윈도우 무작위 분할을 보조적으로 사용합니다. 동일 파일이 서로 다른 subset에 중복되지 않도록 하여 누수를 방지합니다.
- 공통: 모든 분할은 재현 가능한 고정 시드로 수행하고, 클래스 균형이 크게 무너지지 않도록 관리합니다.

## 6) 평가 프로토콜(배포 정합)
- **Retrieval 기반 분류**(주지표): 실제 배포에서는 “후보 텍스트” 중 진동 신호와 가장 유사한 설명을 선택합니다. 이를 그대로 모사하여, 클래스별 텍스트 템플릿(예: “bearing inner race fault”)의 평균 임베딩을 **텍스트 프로토타입**으로 만들고, 테스트 진동 임베딩과 코사인 유사도를 비교해 예측 클래스를 결정합니다.
- **보조 지표**: 텍스트/진동 분류 헤드 정확도(분해능 분석용), Top-5(선택), **망각도**(각 과거 도메인의 최고 성능과 현재 성능 차이의 평균), **단계별 평균 정확도**(각 학습 단계에서 현재까지 도메인의 평균 성능).
- **시각화**: 학습 단계×테스트 도메인의 정확도를 상삼각 행렬로 표현한 Heatmap을 통해 적응과 망각의 양상을 직관적으로 확인합니다.

## 7) 대표 설정(논문 표기용)
- 임베딩 차원: 256
- 대조 손실 마진: 0.3
- 보조 손실 가중치: 초기 정렬 단계(예: 2.0), 연속 적응 단계(예: 5.0)
- 리플레이 버퍼 크기: UOS(예: 500), CWRU(예: 50)
- 텍스트 적응: 첫 도메인에서만 소규모 적응(예: LoRA), 이후 고정
- 최적화: 소규모 데이터 안정화를 위한 보수적 학습률과 짧은 적응 에폭

## 8) 기대 효과와 관찰된 경향
- **도메인 강건성**: 텍스트가 의미론적 앵커로 작동하여, 환경 변화에도 진동 임베딩이 의미와 정합되도록 안내합니다.
- **빠른 적응과 망각 억제**: 비대칭 적응 + 리플레이로 새 도메인에 빠르게 맞추면서 과거 도메인 성능을 유지합니다.
- **실험 경향**: UOS처럼 클래스가 많고 도메인 간 분포 차가 큰 경우 후반 도메인(고RPM)에서 정확도 하락이 나타날 수 있으며, 이는 프로토타입 텍스트 다양화·리플레이 비율 조정·적응 에폭 조절로 개선 가능합니다. CWRU처럼 클래스가 단순하고 분할이 엄격한 경우, retrieval 정확도가 매우 높게 수렴하는 경향이 있습니다.

## 9) 재현 가능 요지(개념 단계)
1) 첫 도메인만으로 텍스트-진동 임베딩 공간을 정렬(대조 손실 + 보조 분류)
2) 이후 도메인에서 텍스트는 고정, 진동 중심으로 적응(소규모 리플레이 병행)
3) 각 단계 후, 현재까지의 모든 도메인을 테스트하여 단계별 평균 정확도와 망각도를 기록
4) 최종적으로 Heatmap과 요약 지표로 결과를 보고

---

문의가 있을 경우, 본 문서를 기준으로 Methodology 서술을 작성하고, 필요 시 별도의 부록에 하이퍼파라미터 표나 텍스트 템플릿 목록(클래스별 2~3개)을 추가해 주십시오.


